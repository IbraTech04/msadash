<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UTM MSA Marketing Command Center</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="msa_logo.png">
  <link rel="icon" type="image/png" sizes="16x16" href="msa_logo.png">
  <link rel="apple-touch-icon" href="msa_logo.png">
  <link rel="shortcut icon" href="msa_logo.png">
  
  <link rel="stylesheet" href="style.css" />

  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Amiri:wght@400;700&family=Cinzel:wght@400;500;600&display=swap" rel="stylesheet">
  
  <!-- Chart.js for analytics -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Marked.js for markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
</head>
<body>
  <!-- Navigation Sidebar -->
  <nav class="sidebar">
    <div class="sidebar-header">
      <img id="logo" src="msa_logo.png" alt="MSA Logo" />
      <h2>UTM MSA Marketing</h2>
      <div class="bismillah-sidebar">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù°Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
    </div>
    
    <div class="nav-menu">
      <a href="#dashboard" class="nav-item active" data-section="dashboard">
        <span class="nav-icon">ğŸ“Š</span>
        <span class="nav-text">Dashboard</span>
      </a>
      <a href="#events" class="nav-item" data-section="events">
        <span class="nav-icon">ğŸ“‹</span>
        <span class="nav-text">Events & Requests</span>
      </a>
      <a href="#spreadsheet" class="nav-item" data-section="spreadsheet">
        <span class="nav-icon">ğŸ§¾</span>
        <span class="nav-text">Spreadsheet View</span>
      </a>
      <a href="#kanban" class="nav-item" data-section="kanban">
        <span class="nav-icon">ğŸ—‚ï¸</span>
        <span class="nav-text">Kanban Board</span>
      </a>
      <a href="#calendar" class="nav-item" data-section="calendar">
        <span class="nav-icon">ğŸ“…</span>
        <span class="nav-text">Calendar</span>
      </a>
      <a href="#analytics" class="nav-item" data-section="analytics">
        <span class="nav-icon">ğŸ“ˆ</span>
        <span class="nav-text">Analytics</span>
      </a>
      <a href="#tools" class="nav-item" data-section="tools">
        <span class="nav-icon">ğŸ› ï¸</span>
        <span class="nav-text">Tools</span>
      </a>
    </div>
    
    <div class="sidebar-footer">
      <div class="ayah-sidebar">
        <p class="highlight">ÙˆÙÙ‚ÙÙ„Ù Ù±Ø¹Ù’Ù…ÙÙ„ÙÙˆØ§ÛŸ ÙÙØ³ÙÙŠÙØ±ÙÙ‰ Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ø¹ÙÙ…ÙÙ„ÙÙƒÙÙ…Ù’</p>
        <a href="https://quran.com/at-tawbah/105" target="_blank"><p class="citation">â€” At-Tawbah 9:105</p></a>
      </div>
      <div class="version-badge">v2026</div>
    </div>


  </nav>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Top Header -->
    <header class="top-header">
      <div class="header-left">
        <button class="sidebar-toggle">â˜°</button>
        <h1>
          <span class="title-full">Marketing Command Centre</span>
          <span class="title-mobile">MSA</span>
        </h1>
      </div>
      <div class="header-right">
        <div id="api-status" class="api-status">ğŸ”„ Connecting...</div>
        <button id="toggle-mode" class="mode-toggle">ğŸŒ™</button>
        <div class="user-menu">
          <span class="user-greeting">Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…</span>
          <button id="login-btn" class="login-btn" style="display: none;">ğŸ” Login with Discord</button>
        </div>
      </div>
    </header>

    <!-- Dashboard Section -->
    <section id="dashboard" class="content-section active">
      <div class="dashboard-grid">
        <!-- Quick Stats -->
        <div class="dashboard-card stats-overview">
          <h3>ğŸ“Š Overview</h3>
          <div class="stats-grid" id="quick-stats">
            <div class="stat-item">
              <span class="stat-number" id="total-events">-</span>
              <span class="stat-label">Total Events</span>
            </div>
            <div class="stat-item">
              <span class="stat-number" id="pending-events">-</span>
              <span class="stat-label">Pending</span>
            </div>
            <div class="stat-item">
              <span class="stat-number" id="completed-events">-</span>
              <span class="stat-label">Completed</span>
            </div>
            <div class="stat-item">
              <span class="stat-number" id="overdue-events">-</span>
              <span class="stat-label">Overdue</span>
            </div>
          </div>
        </div>

        <!-- Recent Events -->
        <div class="dashboard-card recent-events">
          <h3>ğŸ•’ Recent Activity</h3>
          <div id="recent-events-list" class="recent-list">
            <div class="loading">Loading recent events...</div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="dashboard-card quick-actions">
          <h3>âš¡ Quick Actions</h3>
          <div class="action-buttons">
            <button class="action-btn" onclick="openSection('events')">
              <span>ğŸ“</span>
              View All Events
            </button>
            <button class="action-btn" onclick="openSection('calendar')">
              <span>ğŸ“…</span>
              Open Calendar
            </button>
            <button class="action-btn" onclick="refreshData()">
              <span>ğŸ”„</span>
              Refresh Data
            </button>
          </div>
        </div>

        <!-- Mini Calendar -->
        <div class="dashboard-card mini-calendar">
          <h3>ğŸ“… This Month</h3>
          <div id="mini-calendar"></div>
        </div>

        <!-- Cycle View -->
        <div class="dashboard-card cycle-view">
          <h3>ğŸ”„ Current Cycle</h3>
          <div id="cycle-view-content" class="cycle-content">
            <div class="loading">Loading cycle info...</div>
          </div>
        </div>

        <!-- Quick Links -->
        <div class="dashboard-card quick-links">
          <h3>ğŸ”— Quick Links</h3>
          <div class="links-grid">
            <a href="https://www.lensbridge.tech/" target="_blank" class="link-item">
              <span>ğŸ”—</span>LensBridge
            </a>
            <a href="https://www.notion.so/utmmsa2023-24/25-26-20793a1f50b3802fa699ea4681c955b5" target="_blank" class="link-item">
              <span>ğŸ§­</span>MSA Notion
            </a>
            <a href="https://www.notion.so/utmmsa2023-24/Marketing-20793a1f50b38177a868e8bf46ba31ad" target="_blank" class="link-item">
              <span>ğŸ—‚</span>Marketing
            </a>
            <a href="https://www.utm.utoronto.ca/registrar/dates" target="_blank" class="link-item">
              <span>ğŸ“…</span>UTM Dates
            </a>
            <a href="https://calendar.google.com/calendar/u/0?cid=MWQwNDI2ODYwNzkwZWE5ODk1ZGQ3OWZjZTk5MTg0MmFlOWFhNDkyODM1NDJiNzJmMzg2MzJjM2Y3OWZmYjI5ZkBncm91cC5jYWxlbmRhci5nb29nbGUuY29t" target="_blank" class="link-item">
              <span>ğŸ“†</span>Shared Cal
            </a>
          </div>
        </div>

      </div>
    </section>

    <!-- Events / Requests Section -->
    <section id="events" class="content-section">
      <div class="section-header">
        <h2>ğŸ“‹ Marketing Requests Workspace</h2>
        <div class="section-actions">
          <button id="compact-mode-toggle" class="action-btn compact-toggle" title="Toggle compact view (Ctrl+K)">
            <span>ğŸ“</span> Compact Mode
          </button>
        </div>
      </div>
      <div class="requests-layout">
        <!-- Sidebar / Controls -->
        <aside class="requests-sidebar">
          <div class="filter-panel">
            <h3 class="panel-title">Filters</h3>
            <div class="filter-group">
              <label for="request-search">Search</label>
              <input type="text" id="request-search" class="filter-input" placeholder="Search title, description, requester..." />
            </div>
            <div class="filter-row">
              <div class="filter-group">
                <label for="status-filter">Status</label>
                <div class="multi-select-container" id="status-filter-container">
                  <div class="multi-select-summary" id="status-filter-summary">All Statuses</div>
                  <div class="multi-select-dropdown" id="status-filter-dropdown">
                    <label class="multi-select-option">
                      <input type="checkbox" value="ğŸ“¥ In Queue" />
                      <span>ğŸ“¥ In Queue</span>
                    </label>
                    <label class="multi-select-option">
                      <input type="checkbox" value="ğŸ”„ In Progress" />
                      <span>ğŸ”„ In Progress</span>
                    </label>
                    <label class="multi-select-option">
                      <input type="checkbox" value="â³ Awaiting Posting" />
                      <span>â³ Awaiting Posting</span>
                    </label>
                    <label class="multi-select-option">
                      <input type="checkbox" value="âœ… Done" />
                      <span>âœ… Done</span>
                    </label>
                    <label class="multi-select-option">
                      <input type="checkbox" value="ğŸš« Blocked" />
                      <span>ğŸš« Blocked</span>
                    </label>
                  </div>
                </div>
              </div>
              <div class="filter-group">
                <label for="type-filter">Type</label>
                <select id="type-filter" class="filter-select wide">
                  <option value="">All</option>
                  <option value="poster">Poster</option>
                  <option value="social">Social</option>
                  <option value="video">Video</option>
                  <option value="copy">Copy</option>
                </select>
              </div>
            </div>
            <div class="filter-group">
              <label for="dept-filter">Department</label>
              <div class="multi-select-container" id="dept-filter-container">
                <div class="multi-select-summary" id="dept-filter-summary">All Departments</div>
                <div class="multi-select-dropdown" id="dept-filter-dropdown">
                  <!-- Dynamically populated by JS -->
                </div>
              </div>
            </div>
            <div class="filter-actions">
              <button class="filter-btn primary" onclick="applyAllFilters()">Apply</button>
              <button class="filter-btn" onclick="resetRequestFilters()">Reset</button>
            </div>
          </div>
          <div class="summary-panel" id="events-summary">
            <!-- Summary populated by JS -->
          </div>
          <div class="utility-panel">
            <button class="utility-btn" onclick="refreshData()">ğŸ”„ Refresh Data</button>
            <button class="utility-btn" onclick="exportEvents()">ğŸ“¤ Export CSV</button>
          </div>
        </aside>
        <!-- Main Content -->
        <div class="requests-main">
          <div class="requests-toolbar">
            <div class="toolbar-left">
              <div class="active-filters" id="active-filters"></div>
            </div>
            <div class="toolbar-right">
              <span id="filtered-count" class="filtered-count">0 shown</span>
            </div>
          </div>
          <div class="status-grid" id="task-container">
            <div class="loading">ğŸ”„ Loading requests...</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Spreadsheet View Section -->
    <section id="spreadsheet" class="content-section">
      <div class="section-header">
        <h2>ğŸ§¾ Spreadsheet View</h2>
        <div class="section-actions">
          <button class="action-btn" onclick="exportSpreadsheetCsv()">ğŸ“¤ Export</button>
          <button class="action-btn" onclick="refreshSpreadsheet()">ğŸ”„ Refresh</button>
        </div>
      </div>
      
      <!-- Horizontal Filter Bar -->
      <div class="spreadsheet-filters">
        <div class="filter-bar">
          <div class="filter-bar-item">
            <label for="spreadsheet-search">ğŸ” Search</label>
            <input type="text" id="spreadsheet-search" class="filter-input" placeholder="Search..." />
          </div>
          <div class="filter-bar-item">
            <label for="spreadsheet-status-filter">Status</label>
            <div class="multi-select-container" id="spreadsheet-status-filter-container">
              <div class="multi-select-summary" id="spreadsheet-status-filter-summary">All Statuses</div>
              <div class="multi-select-dropdown" id="spreadsheet-status-filter-dropdown">
                <label class="multi-select-option">
                  <input type="checkbox" value="ğŸ“¥ In Queue" />
                  <span>ğŸ“¥ In Queue</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="ğŸ”„ In Progress" />
                  <span>ğŸ”„ In Progress</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="â³ Awaiting Posting" />
                  <span>â³ Awaiting Posting</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="âœ… Done" />
                  <span>âœ… Done</span>
                </label>
                <label class="multi-select-option">
                  <input type="checkbox" value="ğŸš« Blocked" />
                  <span>ğŸš« Blocked</span>
                </label>
              </div>
            </div>
          </div>
          <div class="filter-bar-item">
            <label for="spreadsheet-type-filter">Type</label>
            <select id="spreadsheet-type-filter" class="filter-select">
              <option value="">All Types</option>
              <option value="poster">Poster</option>
              <option value="social">Social</option>
              <option value="video">Video</option>
              <option value="copy">Copy</option>
            </select>
          </div>
          <div class="filter-bar-item">
            <label for="spreadsheet-dept-filter">Department</label>
            <div class="multi-select-container" id="spreadsheet-dept-filter-container">
              <div class="multi-select-summary" id="spreadsheet-dept-filter-summary">All Departments</div>
              <div class="multi-select-dropdown" id="spreadsheet-dept-filter-dropdown">
                <!-- Dynamically populated by JS -->
              </div>
            </div>
          </div>
          <div class="filter-bar-actions">
            <button class="filter-btn secondary" onclick="resetSpreadsheetFilters()" title="Reset all filters">Reset</button>
          </div>
        </div>
        <div class="filter-bar-footer">
          <div class="active-filters" id="spreadsheet-active-filters"></div>
          <div class="filter-bar-info">
            <span id="spreadsheet-filtered-count" class="filtered-count">0 items</span>
            <span class="separator">â€¢</span>
            <span id="spreadsheet-summary-inline" class="summary-inline"></span>
          </div>
        </div>
      </div>
      
      <!-- Spreadsheet Table -->
      <div class="spreadsheet-container">
        <div id="spreadsheet-table-wrapper" class="table-wrapper">
          <div class="loading">Loading requests...</div>
        </div>
      </div>
    </section>

    <!-- Kanban Board Section -->
    <section id="kanban" class="content-section">
      <div class="section-header">
        <h2>ğŸ—‚ï¸ Kanban Board</h2>
        <div class="section-actions">
          <select id="kanban-filter" class="filter-select">
            <option value="">All Departments</option>
            <option value="events">Events</option>
            <option value="marketing">Marketing</option>
            <option value="social-media">Social Media</option>
            <option value="design">Design</option>
          </select>
          <button class="action-btn" onclick="refreshKanban()">ğŸ”„ Refresh</button>
        </div>
      </div>
      
      <div class="kanban-container" id="kanban-container">
        <div class="loading">ğŸ”„ Loading Kanban board...</div>
      </div>
    </section>

    <!-- Calendar Section -->
    <section id="calendar" class="content-section">
      <div class="section-header">
        <h2>ğŸ“… Interactive Deadline Calendar</h2>
        <div class="calendar-controls">
          <button id="cycle-view-toggle" class="cycle-toggle-btn">
            <span class="toggle-icon">ğŸ”„</span>
            <span class="toggle-text">Cycle View: OFF</span>
            <span class="toggle-hint">Hover to highlight â€¢ SHIFT to reverse</span>
          </button>
          <div class="calendar-legend">
            <span class="legend-item status-inqueue">ğŸ“¥ In Queue</span>
            <span class="legend-item status-inprogress">ğŸ”„ In Progress</span>
            <span class="legend-item status-awaitingposting">â³ Awaiting Posting</span>
            <span class="legend-item status-done">âœ… Done</span>
            <span class="legend-item status-blocked">ğŸš« Blocked</span>
            <span class="legend-item cycle-request-legend">Request Window</span>
            <span class="legend-item cycle-production-legend">Production Window</span>
            <span class="legend-item cycle-posting-legend">Posting Window</span>
          </div>
        </div>
      </div>
      <div class="calendar-container">
        <div id="main-calendar"></div>
      </div>
    </section>

    <!-- Analytics Section -->
    <section id="analytics" class="content-section">
      <div class="section-header">
        <h2>ğŸ“ˆ Analytics Dashboard</h2>
        <div class="analytics-controls">
          <select id="analytics-period">
            <option value="7">Last 7 days</option>
            <option value="30" selected>Last 30 days</option>
            <option value="90">Last 90 days</option>
          </select>
        </div>
      </div>
      
      <div class="analytics-grid">
        <div class="analytics-card">
          <h3>Status Distribution</h3>
          <canvas id="statusChart"></canvas>
        </div>
        <div class="analytics-card">
          <h3>Completion Timeline</h3>
          <canvas id="timelineChart"></canvas>
        </div>
        <div class="analytics-card">
          <h3>Request Types</h3>
          <canvas id="typeChart"></canvas>
        </div>
        <div class="analytics-card">
          <h3>Performance Metrics</h3>
          <div class="metrics-list">
            <div class="metric-item">
              <span class="metric-label">Avg. Completion Time</span>
              <span class="metric-value" id="avg-completion">-</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">Success Rate</span>
              <span class="metric-value" id="success-rate">-</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">Peak Activity Day</span>
              <span class="metric-value" id="peak-day">-</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Team Section removed -->

    <!-- Tools Section -->
    <section id="tools" class="content-section">
      <div class="section-header">
        <h2>ğŸ› ï¸ Tools</h2>
      </div>
      
      <div class="tools-grid">
        <div class="tool-card">
          <h3>ğŸ§ª API Testing</h3>
          <p>Test your API connection and endpoints</p>
          <div class="api-test-section">
            <button onclick="testApiConnection()" class="action-btn">Test API Health</button>
            <button onclick="testApiEvents()" class="action-btn">Test Events Endpoint</button>
            <div id="api-test-results" class="test-results"></div>
          </div>
        </div>
        
        <div class="tool-card">
          <h3>ğŸ“¤ Export Data</h3>
          <p>Export events and analytics data</p>
          <div class="export-section">
            <button onclick="exportEvents()" class="action-btn">Export Events CSV</button>
            <button onclick="refreshData()" class="action-btn">Refresh All Data</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Error/Success Toast -->
  <div id="toast" class="toast"></div>

  <!-- API Error Display -->
  <div id="api-error" class="api-error" style="display: none;"></div>

  <!-- Footer -->
  <footer class="main-footer">
    <p>JazakumAllahu khairan! â€¢ Built with ğŸ’™ for UTM MSA Marketing Team</p>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
  <script src="/env.js"></script>
  <script src="/config.js"></script>
  <script src="/api-service.js"></script>
  <script src="/js/msa-namespace.js"></script>
  <script src="/js/date-utils.js"></script>
  <script src="/js/stats.js"></script>
  <script src="/js/events-board.js"></script>
  <script src="/js/main-calendar.js"></script>
  <!-- Modularized dashboard scripts -->
  <script src="/js/utils-modal.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/cycle-view.js"></script>
  <script src="/js/spreadsheet.js"></script>
  <script src="/js/recent-activity.js"></script>
  <script src="/js/mini-calendar.js"></script>
  <script src="/js/analytics.js"></script>
  <script src="/js/kanban.js"></script>
  <script src="/js/namespace-adapter.js"></script>
  <script src="/script.js"></script>
</body>
</html>
